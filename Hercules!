<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar's Royal Disk: Codex Caesari</title>
    <style>
        body { 
            background-color: #2c241e;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
            display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0;
            font-family: 'Times New Roman', serif; color: #5d0000;
        }
        .scroll { 
            background: #f4e4bc; padding: 30px; border-radius: 5px;
            box-shadow: 0 0 30px rgba(0,0,0,0.7); width: 95%; max-width: 500px;
            border: 12px solid #8b4513; text-align: center;
        }
        h1 { text-transform: uppercase; letter-spacing: 3px; margin-top: 0; border-bottom: 2px solid #5d0000; }
        
        .key-window {
            background: #3d2b1f; color: #f4e4bc; width: 60px; margin: 10px auto;
            padding: 5px; border-radius: 4px; border: 2px solid #8b4513;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); font-weight: bold; font-size: 1.2rem;
        }

        .disk-container { position: relative; width: 320px; height: 320px; margin: 10px auto; }
        .ring {
            position: absolute; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #outer-ring { width: 100%; height: 100%; background: #d4c49a; border: 4px solid #5d0000; }
        #inner-ring {
            width: 70%; height: 70%; top: 15%; left: 15%;
            background: #e6d5ac; border: 3px solid #8b4513;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3); cursor: pointer;
        }
        .letter {
            position: absolute; width: 20px; height: 100%;
            display: flex; align-items: flex-start; justify-content: center;
            font-weight: bold; padding-top: 5px;
        }
        .inner-letter { padding-top: 10px; color: #8b4513; }

        .controls { display: flex; gap: 10px; margin-bottom: 10px; }
        .mode-btn { flex: 1; padding: 10px; cursor: pointer; border: 2px solid #5d0000; background: none; font-weight: bold; }
        .mode-btn.active { background: #5d0000; color: #f4e4bc; }
        
        textarea { 
            width: 100%; height: 60px; padding: 10px; box-sizing: border-box; 
            background: rgba(255,255,255,0.3); border: 1px solid #8b4513; 
            font-family: 'Times New Roman', serif;
        }

        /* BOLD OUTPUT - Updated weight and size */
        .output { 
            margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.05); 
            border: 1px dashed #8b4513; min-height: 40px; 
            font-style: italic; font-weight: 900; font-size: 1.4rem; 
            color: #2c241e; overflow-wrap: break-word;
        }
        
        /* Game elements */
        .task-list { text-align: left; max-width: 400px; margin: 20px auto; border: 1px solid #8b4513; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 5px;}
        .task-list h3 { margin-top: 0; text-transform: uppercase; color: #5d0000; border-bottom: 1px solid #8b4513;}
        .task-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-weight: bold; }
        .task-status { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #8b4513; background: transparent; transition: background 0.3s; }
        .task-status.complete { background: green; border-color: green; }
        #task-result { margin-top: 20px; font-weight: bold; text-transform: uppercase; font-size: 1.2rem; color: #5d0000; display: none;}
    </style>
</head>
<body>

<div class="scroll">
    <h1>Codex Caesari</h1>
    <p>Complete the first 3 Tasks to begin your path to immortality.</p>
    
    <div class="task-list">
        <h3>Tasks</h3>
        <div class="task-item">
            <span>Task 1: The Lion Cipher</span>
            <div class="task-status" id="status1"></div>
        </div>
        <div class="task-item">
            <span>Task 2: The Hydra's Lock</span>
            <div class="task-status" id="status2"></div>
        </div>
        <div class="task-item">
            <span>Task 3: The Golden Stag</span>
            <div class="task-status" id="status3"></div>
        </div>
    </div>

    <div id="game-controls">
        <div class="controls">
            <button id="encBtn" class="mode-btn active" onclick="setMode('encode')">ENCODE</button>
            <button id="decBtn" class="mode-btn" onclick="setMode('decode')">DECODE</button>
        </div>

        <label style="font-weight:bold; letter-spacing: 1px;">CURRENT SHIFT</label>
        <div class="key-window" id="shift-val">0</div>

        <div class="disk-container">
            <div id="outer-ring" class="ring"></div>
            <div id="inner-ring" class="ring" onclick="rotateRing()"></div>
        </div>

        <textarea id="message" placeholder="Type your message..."></textarea>
        <div id="result" class="output">...</div>
    </div>
    <div id="task-result">YOU HAVE PASSED THE INITIAL TRIALS!</div>
</div>

<script>
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let currentShift = 0;
    let mode = 'encode';
    
    // Tasks and solution keys
    const solutions = {
        task1: { shift: 4, message: 'LION PASSED' }, // Encoding 'LION PASSED' with +4 shift gives 'PSMR TEWWIH'
        task2: { shift: 17, message: 'HYDRA' }, // Lock requires a key of 17
        task3: { shift: 22, message: 'GOLDEN STAG' } // Final key of 22 to decode the message
    };
    
    // Build the rings
    function createRing(elementId, chars, isInner) {
        const ring = document.getElementById(elementId);
        for (let i = 0; i < 26; i++) {
            const div = document.createElement('div');
            div.className = isInner ? 'letter inner-letter' : 'letter';
            div.innerText = chars[i];
            div.style.transform = `rotate(${i * (360 / 26)}deg)`;
            ring.appendChild(div);
        }
    }

    createRing('outer-ring', alphabet, false);
    createRing('inner-ring', alphabet.toLowerCase(), true);

    function rotateRing() {
        currentShift = (currentShift + 1) % 26;
        document.getElementById('inner-ring').style.transform = `rotate(-${currentShift * (360 / 26)}deg)`;
        document.getElementById('shift-val').innerText = currentShift;
        update();
        checkTaskStatus();
    }

    function setMode(m) {
        mode = m;
        document.getElementById('encBtn').classList.toggle('active', mode === 'encode');
        document.getElementById('decBtn').classList.toggle('active', mode === 'decode');
        update();
        checkTaskStatus();
    }

    function caesarCipher(str, shift) {
        if (mode === 'decode') shift = (26 - (shift % 26)) % 26;
        return str.replace(/[a-z]/gi, (char) => {
            const start = char <= 'Z' ? 65 : 97;
            return String.fromCharCode(((char.charCodeAt(0) - start + shift) % 26 + 26) % 26 + start);
        });
    }

    function update() {
        const text = document.getElementById('message').value;
        document.getElementById('result').innerText = caesarCipher(text, currentShift) || "...";
    }

    // Task completion logic
    function checkTaskStatus() {
        const resultText = document.getElementById('result').innerText.trim();
        const shiftVal = parseInt(document.getElementById('shift-val').innerText);
        const modeVal = mode;

        let complete1 = document.getElementById('status1').classList.contains('complete');
        let complete2 = document.getElementById('status2').classList.contains('complete');
        let complete3 = document.getElementById('status3').classList.contains('complete');

        // Task 1: Check encoded message from specific key and input
        if (!complete1 && modeVal === 'encode' && shiftVal === solutions.task1.shift && resultText === 'PSMR TEWWIH') {
            document.getElementById('status1').classList.add('complete');
            complete1 = true;
        }

        // Task 2: Check decoded message with specific key
        if (!complete2 && modeVal === 'decode' && shiftVal === solutions.task2.shift && resultText === solutions.task2.message) {
            document.getElementById('status2').classList.add('complete');
            complete2 = true;
        }
        
        // Task 3: Only check once T2 is done, uses decoded output
        if (complete1 && complete2 && !complete3 && modeVal === 'decode' && shiftVal === solutions.task3.shift && resultText === solutions.task3.message) {
             document.getElementById('status3').classList.add('complete');
             complete3 = true;
        }
        
        // Final completion check
        if (complete1 && complete2 && complete3) {
            document.getElementById('task-result').style.display = 'block';
            document.getElementById('game-controls').style.display = 'none';
        }
    }

    document.getElementById('message').addEventListener('input', () => { update(); checkTaskStatus(); });
</script>

</body>
</html>
